# 付録M: バージョニングとリリース管理

本付録は Workflow Cookbook のリリース判定に必要なバージョン管理と配布物検証の流れを集約する。`CHECKLISTS.md#release` と [`docs/Release_Checklist.md`](../Release_Checklist.md) を実行する前提で、ここに記載した基準を順守すること。

## セマンティックバージョニング
- バージョンは `MAJOR.MINOR.PATCH` 形式で管理し、互換性破壊時のみ `MAJOR` を増分する。
- 後方互換のある機能追加は `MINOR`、バグ修正や文書整理は `PATCH` を増分する。
- `CHANGELOG.md` の `[Unreleased]` 節からリリース対象差分を昇格させる際、次回バージョン番号と日付を確定する。
- リリースブランチが存在する場合は、対象ブランチ上でバージョン更新コミットとタグ付けを完了させる。

## Git タグ命名規則
- 公開タグは `vMAJOR.MINOR.PATCH` 形式で作成する（例: `v0.3.1`）。
- タグはリリース対象コミットに対して軽量タグではなく注釈付きタグで作成する（`git tag -a v0.3.1 -m "Release v0.3.1"`）。
- `git push --tags` を実行し、保守対象ブランチの先頭コミットと一致することを突合する。
- 再発行が必要な場合はタグを削除 (`git tag -d v0.3.1`) → リモート削除 (`git push origin :refs/tags/v0.3.1`) → 再タグ付けの順で対応する。

## CHANGELOG 通番管理
- 各リリース項目の箇条書きは 4 桁ゼロ埋めの通番（`0001` など）を付与する。
- 通番は `CHANGELOG.md` 全体で単調増加とし、新規項目は既存最大値に 1 を加えて採番する。
- `[Unreleased]` 節で通番を先行採番した場合は、リリース確定時に値が欠番・重複していないかを再確認する。
- `CHANGELOG.md` 更新後は PR/Issue へ通番とリンクを記録し、監査ログと整合させる。

## 配布物チェックフロー
1. `docs/Release_Checklist.md` の該当リストをすべて通過する。
2. 生成した配布物（アーカイブ・Docker イメージ等）に `LICENSE` と `NOTICE` を同梱し、ハッシュ値や署名を検証する。
3. 配布物のバージョン番号と Git タグが一致することを確認する。
4. QA / セキュリティ / ガバナンスの証跡を PR かリリースチケットへ添付し、参照リンクを `CHANGELOG.md` の対応項目へ追記する。
5. 公開後は `RUNBOOK.md` に沿って監視ポイントを確認し、必要なフォローアップタスクを `TASK.codex.md` テンプレートで起票する。
